/*! Copyright 2025 Adobe
All Rights Reserved. */
var F=Object.defineProperty;var g=(r,t,e)=>t in r?F(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var s=(r,t,e)=>g(r,typeof t!="symbol"?t+"":t,e);const b={"Content-Type":"application/json",Accept:"application/json"};class f{constructor(){s(this,"_endpoint");s(this,"_fetchGraphQlHeaders",{});s(this,"_beforeHooks",[]);s(this,"_afterHooks",[])}get endpoint(){return this._endpoint}get fetchGraphQlHeaders(){return this._fetchGraphQlHeaders}setEndpoint(t){this._endpoint=t}setFetchGraphQlHeader(t,e){this._fetchGraphQlHeaders={...this._fetchGraphQlHeaders,[t]:e}}removeFetchGraphQlHeader(t){delete this._fetchGraphQlHeaders[t]}getFetchGraphQlHeader(t){return this._fetchGraphQlHeaders[t]}setFetchGraphQlHeaders(t){typeof t=="function"?this._fetchGraphQlHeaders={...this._fetchGraphQlHeaders,...t(this._fetchGraphQlHeaders)}:this._fetchGraphQlHeaders={...t}}addBeforeHook(t){this._beforeHooks.push(t)}addAfterHook(t){this._afterHooks.push(t)}_collectBeforeHooks(){return this._beforeHooks}_collectAfterHooks(){return this._afterHooks}async fetchGraphQl(t,e){const h=this.endpoint,p=this.fetchGraphQlHeaders;if(!h)throw Error('Missing "url"');const d=(e==null?void 0:e.method)??"POST",_=e==null?void 0:e.cache,G=e==null?void 0:e.signal;let n;const i=new URL(h),Q={...b,...p};d==="POST"&&(n=JSON.stringify({query:t,variables:e==null?void 0:e.variables})),d==="GET"&&(i.searchParams.append("query",v(t)),e!=null&&e.variables&&i.searchParams.append("variables",JSON.stringify(e.variables)));let a={method:d,headers:Q,body:n,cache:_,signal:G};a=await this._collectBeforeHooks().reduce(async(c,o)=>o(await c),Promise.resolve(a));const u=this._collectAfterHooks();return await fetch(i,a).then(c=>c.json().then(o=>u.reduce(async(k,m)=>m(a,await k),Promise.resolve(o))))}getConfig(){return{endpoint:this.endpoint,fetchGraphQlHeaders:this.fetchGraphQlHeaders}}getMethods(){return{setEndpoint:this.setEndpoint.bind(this),setFetchGraphQlHeader:this.setFetchGraphQlHeader.bind(this),getFetchGraphQlHeader:this.getFetchGraphQlHeader.bind(this),removeFetchGraphQlHeader:this.removeFetchGraphQlHeader.bind(this),setFetchGraphQlHeaders:this.setFetchGraphQlHeaders.bind(this),fetchGraphQl:this.fetchGraphQl.bind(this),getConfig:this.getConfig.bind(this),addBeforeHook:this.addBeforeHook.bind(this),addAfterHook:this.addAfterHook.bind(this)}}}const l=new f;class H extends f{constructor(){super(...arguments);s(this,"_mode","default");s(this,"_source")}get endpoint(){var e;switch(this._mode){case"standalone":return this._source;case"linked":return(e=this._source)==null?void 0:e.endpoint;case"default":return l.endpoint}}get fetchGraphQlHeaders(){switch(this._mode){case"standalone":return this._fetchGraphQlHeaders;case"linked":return this._source.fetchGraphQlHeaders;case"default":return{...l.fetchGraphQlHeaders,...this._fetchGraphQlHeaders}}}setEndpoint(e){e instanceof H?(this._mode="linked",this._source=e):(this._mode="standalone",this._source=e)}setFetchGraphQlHeader(e,h){this._mode==="linked"?this._source.setFetchGraphQlHeader(e,h):super.setFetchGraphQlHeader(e,h)}setFetchGraphQlHeaders(e){this._mode==="linked"?this._source.setFetchGraphQlHeaders(e):super.setFetchGraphQlHeaders(e)}removeFetchGraphQlHeader(e){this._mode==="linked"?this._source.removeFetchGraphQlHeader(e):super.removeFetchGraphQlHeader(e)}getFetchGraphQlHeader(e){return this._mode==="linked"?this._source.getFetchGraphQlHeader(e):super.getFetchGraphQlHeader(e)}addBeforeHook(e){this._mode==="linked"?this._source.addBeforeHook(e):super.addBeforeHook(e)}addAfterHook(e){this._mode==="linked"?this._source.addAfterHook(e):super.addAfterHook(e)}_collectBeforeHooks(){return this._mode==="linked"?this._source._collectBeforeHooks():this._beforeHooks}_collectAfterHooks(){return this._mode==="linked"?this._source._collectAfterHooks():this._afterHooks}}function v(r){return r=r.replace(/#.*/g,""),r=r.replace(/\s+/g," "),r.trim()}const{setEndpoint:w,setFetchGraphQlHeaders:E,setFetchGraphQlHeader:P,getFetchGraphQlHeader:C,removeFetchGraphQlHeader:M,fetchGraphQl:O,getConfig:S,addBeforeHook:T,addAfterHook:j}=l.getMethods();export{H as FetchGraphQL,j as addAfterHook,T as addBeforeHook,O as fetchGraphQl,S as getConfig,C as getFetchGraphQlHeader,M as removeFetchGraphQlHeader,w as setEndpoint,P as setFetchGraphQlHeader,E as setFetchGraphQlHeaders};
//# sourceMappingURL=fetch-graphql.js.map
